<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•½ë¬¼/ì‚¬ì´ë²„ ì¤‘ë… ì˜ˆë°© - ê±°ì ˆí•˜ê¸° | 7 ì•ˆì „ì¢Œì˜ ì£¼ì¸ì€ ëˆ„êµ¬ì¸ê°€</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/game.css">
    <link rel="stylesheet" href="../css/chatbot.css">
    <style>
        /* Specific override for Chatbot Orientation */
        #chatbotCharacter .character-image {
            transform: scaleX(1) !important;
        }

        #chatbotCharacter:hover .character-image {
            transform: translateY(-5px) scaleX(1) !important;
        }

        /* Match image font and sizes - Refined Design */
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .game-board-header {
            background: #f7d770 !important;
            /* Bright Yellow from image */
            padding: 20px !important;
        }

        .game-board-title {
            font-size: 1.5rem !important;
            /* Matching image header size */
            color: #333 !important;
        }

        .scenario-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 40px 30px;
            color: white;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .scenario-emoji {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        .scenario-speaker {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .scenario-text {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.6;
            word-break: keep-all;
        }

        .response-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .response-btn {
            padding: 20px 25px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 500;
            text-align: left;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #333;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .response-btn:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .response-btn.correct {
            background: #e8f5e9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .response-btn.wrong {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }

        .response-icon {
            font-size: 1.6rem;
        }

        .result-explanation {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #4caf50;
            font-size: 1.1rem;
            line-height: 1.6;
            color: #444;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <header class="game-header">
            <div class="game-title-section">
                <button class="back-btn" onclick="location.href='../index.html'">â†</button>
                <h1 class="game-title"><span class="game-emoji">ğŸš«</span> ì•½ë¬¼ ë° ì‚¬ì´ë²„ ì¤‘ë… ì˜ˆë°©</h1>
            </div>
            <div class="game-stats">
                <div class="stat-item">
                    <span class="stat-icon">ğŸ“‹</span>
                    <span class="stat-value" id="progress">1/5</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">ğŸ’ª</span>
                    <span class="stat-value" id="correct">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">â­</span>
                    <span class="stat-value" id="score">0</span>
                </div>
            </div>
        </header>

        <main class="game-content">
            <div class="game-board">
                <div class="game-board-header">
                    <h2 class="game-board-title">ğŸš« ìœ í˜¹ì„ ê±°ì ˆí•˜ëŠ” ë°©ë²•ì„ ë°°ì›Œìš”!</h2>
                </div>
                <div class="game-board-content">
                    <div class="start-screen" id="startScreen">
                        <div class="start-emoji">ğŸš«</div>
                        <h2 class="start-title">ê±°ì ˆí•˜ê¸° ê²Œì„</h2>
                        <p class="start-description">
                            ë‹´ë°°, ìˆ , ê²Œì„ ì¤‘ë… ë“± ë‹¤ì–‘í•œ ìœ í˜¹ ìƒí™©ì´ ë‚˜ì˜µë‹ˆë‹¤.<br>
                            ì˜¬ë°”ë¥´ê²Œ ê±°ì ˆí•˜ëŠ” ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”!
                        </p>
                        <button class="start-btn" id="startBtn">ê²Œì„ ì‹œì‘!</button>
                    </div>

                    <div class="quiz-container hidden" id="gameArea">
                        <div class="scenario-card" id="scenarioCard">
                            <div class="scenario-emoji" id="scenarioEmoji">ğŸš¬</div>
                            <div class="scenario-speaker" id="scenarioSpeaker">ì¹œêµ¬ê°€ ë§í•´ìš”:</div>
                            <p class="scenario-text" id="scenarioText"></p>
                        </div>
                        <div class="response-options" id="options"></div>
                        <div class="result-explanation hidden" id="explanation"></div>
                    </div>

                    <div class="game-over-screen" id="gameOverScreen">
                        <h2 class="game-over-title" id="resultTitle">ê²Œì„ ì¢…ë£Œ!</h2>
                        <p class="game-over-score" id="resultScore"></p>
                        <div class="game-over-stars" id="resultStars"></div>
                        <div class="game-over-buttons">
                            <button class="btn btn-primary btn-pixel" onclick="location.reload()">ë‹¤ì‹œí•˜ê¸°</button>
                            <button class="btn btn-gold btn-pixel" onclick="location.href='../index.html'">ëŒì•„ê°€ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/main.js"></script>
    <script src="../js/chatbot.js"></script>
    <script src="../js/survey.js"></script>
    <script>
        const scenarios = [
            {
                emoji: "ğŸš¬",
                speaker: "ì¹œêµ¬ê°€ ë§í•´ìš”:",
                text: "ì•¼, ë‹´ë°° í•œ ëŒ€ë§Œ í”¼ì›Œë´. ì–´ë¥¸ë“¤ë§Œ í”¼ìš°ëŠ” ê±° ì•„ë‹ˆì•¼. ë©‹ìˆì–ì•„!",
                options: [
                    { text: "ê·¸ë˜, í•œ ë²ˆë§Œ í•´ë³¼ê²Œ", icon: "ğŸ˜…", correct: false },
                    { text: "ì‹«ì–´, ë‹´ë°°ëŠ” ê±´ê°•ì— í•´ë¡œì›Œ. ë‚œ ì•ˆ í•´", icon: "ğŸ’ª", correct: true },
                    { text: "ìŒ... ì¢€ ë” ìƒê°í•´ë³¼ê²Œ", icon: "ğŸ¤”", correct: false },
                    { text: "ë¶€ëª¨ë‹˜í•œí…Œ ë¬¼ì–´ë³´ê³ ", icon: "ğŸ˜°", correct: false }
                ],
                explanation: "ë‹´ë°°ëŠ” ì•”, ì‹¬ì¥ë³‘ ë“± ì‹¬ê°í•œ ì§ˆë³‘ì„ ì¼ìœ¼ì¼œìš”. 'ì‹«ì–´'ë¼ê³  ë¶„ëª…íˆ ë§í•˜ê³ , ì´ìœ ë„ í•¨ê»˜ ë§í•˜ë©´ ë” ì¢‹ì•„ìš”!"
            },
            {
                emoji: "ğŸº",
                speaker: "ì„ ë°°ê°€ ë§í•´ìš”:",
                text: "ì´ê±° ë§¥ì£¼ì¸ë°, ì¡°ê¸ˆë§Œ ë§ˆì…”ë´. ì–´ë¥¸ ë˜ë©´ ë‹¤ ë§ˆì‹œëŠ” ê±°ì•¼.",
                options: [
                    { text: "ì•„, ì € ë¯¸ì„±ë…„ìë¼ ìˆ  ëª» ë§ˆì…”ìš”. ìŒë£Œìˆ˜ ë§ˆì‹¤ê²Œìš”!", icon: "ğŸ§ƒ", correct: true },
                    { text: "ì„ ë°°ê°€ ì£¼ì‹œëŠ” ê±°ë‹ˆê¹Œ ì¡°ê¸ˆë§Œ...", icon: "ğŸ˜“", correct: false },
                    { text: "ë¶€ëª¨ë‹˜ ì˜¤ì‹œë©´ ë“œì„¸ìš”", icon: "ğŸ˜…", correct: false },
                    { text: "ì €ë„ ì–´ë¥¸ì²˜ëŸ¼ ë§ˆì…”ë³¼ë˜ìš”", icon: "ğŸ¤ª", correct: false }
                ],
                explanation: "ë¯¸ì„±ë…„ì ìŒì£¼ëŠ” ë¶ˆë²•ì´ì—ìš”. ë‡Œ ë°œë‹¬ì—ë„ ë‚˜ìœ ì˜í–¥ì„ ì¤˜ìš”. ë‹¹ë‹¹í•˜ê²Œ ê±°ì ˆí•˜ì„¸ìš”!"
            },
            {
                emoji: "ğŸ“±",
                speaker: "ê²Œì„ ì¹œêµ¬ê°€ ë§í•´ìš”:",
                text: "ì•¼, ì˜¤ëŠ˜ ìƒˆë²½ê¹Œì§€ ê²Œì„í•˜ì! ë‚´ì¼ í•™êµ ê·¸ëƒ¥ ë¹ ì§€ë©´ ë˜ì–ì•„.",
                options: [
                    { text: "ê·¸ë˜! í•™êµë³´ë‹¤ ê²Œì„ì´ ì¬ë°Œì–´!", icon: "ğŸ®", correct: false },
                    { text: "ì•„ë‹ˆ, ë‚˜ 10ì‹œê¹Œì§€ë§Œ í•˜ê³  ì˜ ê±°ì•¼. ê±´ê°•ë„ ì±™ê²¨ì•¼ì§€!", icon: "ğŸ˜Š", correct: true },
                    { text: "ë¶€ëª¨ë‹˜ ì£¼ë¬´ì‹œë©´ ëª°ë˜...", icon: "ğŸ¤«", correct: false },
                    { text: "ì–´... ê·¸ëƒ¥ í•˜ë˜ ëŒ€ë¡œ í• ê²Œ", icon: "ğŸ˜", correct: false }
                ],
                explanation: "ê²Œì„ ì¤‘ë…ì€ í•™ì—…, ê±´ê°•, ì¹œêµ¬ ê´€ê³„ì— ëª¨ë‘ ë‚˜ìœ ì˜í–¥ì„ ì¤˜ìš”. ì •í•´ì§„ ì‹œê°„ë§Œ í•˜ëŠ” ê²Œ ì¤‘ìš”í•´ìš”!"
            },
            {
                emoji: "ğŸ’Š",
                speaker: "ëª¨ë¥´ëŠ” í˜•ì´ ë§í•´ìš”:",
                text: "ì´ê±° ë¨¹ìœ¼ë©´ ê¸°ë¶„ì´ ì§„ì§œ ì¢‹ì•„ì ¸. í•œ ì•Œë§Œ ë¨¹ì–´ë´, ë¬´ë£Œì•¼.",
                options: [
                    { text: "ë¬´ë£Œë©´ í•˜ë‚˜ë§Œ...", icon: "ğŸ¤”", correct: false },
                    { text: "ëì–´ìš”! ì € ê·¸ëŸ° ê±° ì•ˆ í•´ìš”. (ë¹ ë¥´ê²Œ ìë¦¬ë¥¼ í”¼í•œë‹¤)", icon: "ğŸƒ", correct: true },
                    { text: "ë­”ë°ìš”? ì„¤ëª…í•´ì£¼ì„¸ìš”", icon: "â“", correct: false },
                    { text: "ì¹œêµ¬ë“¤í•œí…Œë„ ê°€ì ¸ë‹¤ì¤„ê²Œìš”", icon: "ğŸ˜ˆ", correct: false }
                ],
                explanation: "ëª¨ë¥´ëŠ” ì•½ë¬¼ì€ ì ˆëŒ€ ë¨¹ìœ¼ë©´ ì•ˆ ë¼ìš”! ë§ˆì•½ì¼ ìˆ˜ ìˆì–´ìš”. ì¦‰ì‹œ ìë¦¬ë¥¼ í”¼í•˜ê³  ì–´ë¥¸ì—ê²Œ ì•Œë¦¬ì„¸ìš”!"
            },
            {
                emoji: "ğŸŒ",
                speaker: "ì˜¨ë¼ì¸ ì¹œêµ¬ê°€ ë§í•´ìš”:",
                text: "ë„ˆ ê°œì¸ì •ë³´ ì•Œë ¤ì¤˜. ì´ë¦„, í•™êµ, ì „í™”ë²ˆí˜¸! ìš°ë¦¬ ë” ì¹œí•´ì§€ì~",
                options: [
                    { text: "ì¢‹ì•„! ìš°ë¦¬ ì¹œêµ¬ë‹ˆê¹Œ~ (ì •ë³´ë¥¼ ì•Œë ¤ì¤€ë‹¤)", icon: "ğŸ“", correct: false },
                    { text: "ë¯¸ì•ˆ, ê°œì¸ì •ë³´ëŠ” ì•Œë ¤ì¤„ ìˆ˜ ì—†ì–´. ì˜¨ë¼ì¸ì—ì„  ì¡°ì‹¬í•´ì•¼ í•´!", icon: "ğŸ”’", correct: true },
                    { text: "í•™êµ ì´ë¦„ë§Œ ì•Œë ¤ì¤„ê²Œ", icon: "ğŸ«", correct: false },
                    { text: "ë¶€ëª¨ë‹˜ ì •ë³´ë„ ì¤„ê¹Œ?", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§", correct: false }
                ],
                explanation: "ì˜¨ë¼ì¸ì—ì„œ ë§Œë‚œ ì‚¬ëŒì—ê²Œ ê°œì¸ì •ë³´ë¥¼ ì£¼ë©´ ì•ˆ ë¼ìš”. ë²”ì£„ì— ì•…ìš©ë  ìˆ˜ ìˆì–´ìš”!"
            }
        ];

        const state = { current: 0, correct: 0, score: 0, answered: false };

        const el = {
            startScreen: document.getElementById('startScreen'),
            gameArea: document.getElementById('gameArea'),
            scenarioEmoji: document.getElementById('scenarioEmoji'),
            scenarioSpeaker: document.getElementById('scenarioSpeaker'),
            scenarioText: document.getElementById('scenarioText'),
            options: document.getElementById('options'),
            explanation: document.getElementById('explanation'),
            progress: document.getElementById('progress'),
            correct: document.getElementById('correct'),
            score: document.getElementById('score'),
            gameOverScreen: document.getElementById('gameOverScreen'),
            resultTitle: document.getElementById('resultTitle'),
            resultScore: document.getElementById('resultScore'),
            resultStars: document.getElementById('resultStars')
        };

        // Initialize Chatbot immediately so it's visible on start screen
        const chatbot = new Chatbot('addiction_prevention');

        document.getElementById('startBtn').addEventListener('click', startGame);

        function startGame() {
            el.startScreen.classList.add('hidden');
            el.gameArea.classList.remove('hidden');
            showScenario();
        }

        function showScenario() {
            const s = scenarios[state.current];
            state.answered = false;

            el.scenarioEmoji.textContent = s.emoji;
            el.scenarioSpeaker.textContent = s.speaker;
            el.scenarioText.textContent = s.text;
            el.explanation.classList.add('hidden');
            el.options.innerHTML = '';

            s.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'response-btn';
                btn.innerHTML = `<span class="response-icon">${opt.icon}</span><span>${opt.text}</span>`;
                btn.addEventListener('click', () => selectAnswer(i, opt.correct));
                el.options.appendChild(btn);
            });

            updateUI();
        }

        function selectAnswer(index, isCorrect) {
            if (state.answered) return;
            state.answered = true;

            const s = scenarios[state.current];
            const buttons = el.options.querySelectorAll('.response-btn');

            buttons.forEach((btn, i) => {
                btn.style.pointerEvents = 'none';
                if (s.options[i].correct) btn.classList.add('correct');
                if (i === index && !isCorrect) btn.classList.add('wrong');
            });

            if (isCorrect) {
                state.correct++;
                state.score += 200;
            }

            el.explanation.innerHTML = `<strong>${isCorrect ? 'âœ… ì •ë‹µ!' : 'âŒ ì•„ì‰¬ì›Œìš”!'}</strong><br>${s.explanation}`;
            el.explanation.classList.remove('hidden');

            updateUI();

            setTimeout(() => {
                state.current++;
                if (state.current < scenarios.length) {
                    showScenario();
                } else {
                    endGame();
                }
            }, 3000);
        }

        function updateUI() {
            el.progress.textContent = `${state.current + 1}/${scenarios.length}`;
            el.correct.textContent = state.correct;
            el.score.textContent = state.score;
        }

        function endGame() {
            const stars = state.correct >= 4 ? 3 : 0;

            el.resultTitle.textContent = stars >= 2 ? 'ğŸ‰ ê±°ì ˆì™•ì´ ë˜ì—ˆì–´ìš”!' : 'ğŸ’ª ì—°ìŠµí•˜ë©´ ë” ì˜í•  ìˆ˜ ìˆì–´ìš”!';
            el.resultTitle.style.color = stars >= 2 ? '#2ECC71' : '#FCBC00';
            el.resultScore.textContent = `ì •ë‹µ: ${state.correct}/${scenarios.length} | ì ìˆ˜: ${state.score}ì `;
            el.resultStars.textContent = 'â­'.repeat(stars) + 'â˜†'.repeat(3 - stars);

            el.gameOverScreen.classList.add('active');

            if (typeof ProgressManager !== 'undefined') {
                ProgressManager.completeGame('addiction_prevention', stars);
            }

            setTimeout(() => {
                new SurveyModal('addiction_prevention', 'ì•½ë¬¼ ë° ì‚¬ì´ë²„ ì¤‘ë… ì˜ˆë°©', () => { });
                document.querySelector('.modal-overlay').classList.add('active');
            }, 1500);
        }
    </script>
</body>

</html>